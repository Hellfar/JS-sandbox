<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
	<head>
		<meta charset="UTF-8" >
		<title>Motion</title>
	</head>
	<body>
		<svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" id="canvas" >
		</svg>
		<div id="workspace" >
			<input type="button" value="add a shape" onclick="javascript:addShape(this.parentNode);" />
			<input type="button" value="draw" onclick="javascript:draw();" />
			<input id="width" placeholder="width" /><input id="height" placeholder="height" />
			<script>
				/*
					- Ajouter la possibilite de faire mouvoir les objets.
				*/
Object.prototype.clone =
				function		std_Object_clone( o )
				{
					var			n_o = Object.create(Object.getPrototypeOf(o));
					var			propNames = Object.getOwnPropertyNames(o);

					propNames.forEach(
						function(name)
						{
							var desc = Object.getOwnPropertyDescriptor(o, name);
							Object.defineProperty(n_o, name, desc);
						}
					);

					return (n_o);
				}
Object.prototype.implement =
				function		std_Object_implement( r_obj )
				{
					for (var attr in r_obj)
						if (r_obj.hasOwnProperty(attr))
							this[attr] = r_obj[attr];
					
					return (this);
				};
Object.prototype.properties =
				function		std_Object_properties(  )
				{
					return (Object.getOwnPropertyNames(this));
				};
				
				var				NS = {
					'html'		:'http://www.w3.org/1999/xhtml',
					'svg'		:'http://www.w3.org/2000/svg'
				};
				var				shapes = {
					'rect'		:{'tag':'rect','fill':null,'stroke':null,'x':null,'y':null,'width':null,'height':null,'rx':null,'ry':null},
					'circle'	:{'tag':'circle','fill':null,'stroke':null,'cx':null,'cy':null,'r':null},
					'line'		:{'tag':'line','stroke':null,'x1':null,'y1':null,'x2':null,'y2':null},
				};
				var				templates = {
					'tag'		:Object.getOwnPropertyNames(shapes)
								.implement({'onchange':'javascript:var t=this.parentNode;t.innerHTML=\'\';addElements(NS[\'html\'],t,jsonParams(shapes[this.value],templates));'})
				};
				
				function		draw()
				{
					canvas.innerHTML = "";
					{
						if (!isNaN(width.value) && width.value.length)
							canvas.setAttributeNS(null, 'width', width.value);
						if (!isNaN(height.value) && height.value.length)
							canvas.setAttributeNS(null, 'height', height.value);
					};

					{
						var		paramsPool = document.getElementsByClassName('params'),
								l_paramsPool = paramsPool.length;

						for (var i = 0; i < l_paramsPool; i++)
						{
							var	params = paramsJson(paramsPool[i].childNodes);

							addElements(NS["svg"], canvas, [params]);
						}
					};
				}

				function		jsonParams( o, templates )
				{
					var			params = [],
								props = o.properties(),
								l_props = props.length;

					if (templates == undefined)
						templates = {};

					for (attr in o)
					{
						if (o.hasOwnProperty(attr))
						{
							var		input = {},
									templateAttr = templates[attr];

							switch (typeof (templateAttr))
							{
								case ("string"):
									input = {'tag':'input','name':attr,'placeholder':attr,'type':templateAttr};
									break;
								case ("object"):
									{
										if (templateAttr.constructor == Array)
										{
											var	values = [];

											input = {'tag':'select','name':attr};
											for (k in templateAttr)
											{
												var	value = templateAttr[k];

												if (!isNaN(k) && k.length)
												{
													if (o[attr] == value)
														values.push({'tag':'option','value':value,'selected':'selected','child':[{'tag':'#text','value':value}]});
													else
														values.push({'tag':'option','value':value,'child':[{'tag':'#text','value':value}]});
												}
												else
													input[k] = value;
											}
											input['child'] = values;
										}
									};
									break;
								default:
									input = {'tag':'input','name':attr,'placeholder':attr};
									break;
							};
							input.value = o[attr] || "";
							params.push(input);
						}
					}

					return (params);
				}
				function		paramsJson( params )
				{
					var			element = {},
								l_params = params.length;

					for (var i = 0; i < l_params; i++)
					{
						var		param = params[i];

						element[param.name] = param.value || null;
					}
					
					return (element);
				}

				function		addShape( parent )
				{
					addElements(NS["html"], parent, 
						[
							{'tag':'br'},
							{'tag':'div',/*'style':'border:2px solid black',*/'child':
								[
									{'tag':'span','class':'params','child':jsonParams(shapes[templates.tag[0]],templates)},
									//~ {'tag':'br'},
									//~ {'tag':'label','child':[{'tag':'#text','value':'Motion'}]},
									//~ {'tag':'input','type':'checkbox','onchange':'Javascript:(this.checked)?addElements(NS[\'html\'],this.parentNode,):this.parentNode.getElementsByClassName(\'\');'},
								]
							},
						]);
				}

				function		addElements( ns, parent, elems )
				{
					var			l_elems = elems.length,
								a_o = [];

					for (var i = 0; i < l_elems; i++)
					{
						var		elem = elems[i],
								o;

						if (elem.tag == "#text")
							o = document.createTextNode(elem.value);
						else
						{
							o = document.createElementNS(ns, elem.tag);

							delete (elem.tag);
							if (typeof (elem.child) != "undefined")
								addElements(ns, o, elem.child);
							delete (elem.child);
							for (attr in elem)
								if (elem[attr])
									o.setAttributeNS(null, attr, elem[attr]);
						}
						parent.appendChild(o);
						a_o.push(o);
					}

					return (a_o);
				}
				function		getElements( parent )
				{
					var			a_elements = [],
								childs = parent.childNodes,
								l_childs = childs.length;

					for (var i = 0; i < l_childs; i++)
					{
						var		input = childs[i],
								attrs = input.attributes,
								l_attrs = attrs.length,
								elem = {'tag':input.nodeName};

						for (var e = 0; e < l_attrs; e++)
							elem[attrs[e].name] = attrs[e].value;
						a_elements.push(elem);
					}
					
					return (a_elements);
				}

HTMLElement.prototype.appendChilds =
				function		HTMLElement_appendChilds( a_childs )
				{
					var			l_a_childs = a_childs.length;

					for (var i = 0; i < l_a_childs; i++)
						this.appendChild(a_childs[i]);

					return (this);
				}
			</script>
		</div>
	</body>
</html>
