<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>shape reader</title>
		<style>
			.dropzone
			{
				border			: 2px dashed #BBB;
				border-radius	: 5px;
				padding			: 25px;
				text-align		: center;
				color			: #BBB;
			}
		</style>
	</head>
	<body>
		<p id="render" >
			<div id="shapeList" ></div>
			<div class="dropzone" >Drop shapes here</div>
			<output>
			</output>

			<script>
				function	displayFileByType( file )
				{
					var		name = escape(file.name),
							output = document.querySelector("ul").appendChild(document.createElement('li')),
							reader = new FileReader(),
							content;

					output.innerHTML = '<strong>'+ name +'</strong> ('+ (file.type || 'n/a') +') - '+ file.size +' bytes, last modified: '+ ((file.lastModifiedDate) ? file.lastModifiedDate.toLocaleDateString() : 'n/a');
					if (name.match(/\.obj$/))
					{
						var	items = {};

						reader.onload = (function(f)
						{
							return (function (e)
							{
								content = e.target.result;

								output.innerHTML += '<br />\n<canvas style="border: 1px solid black;" >\nYour browser doesn\'t appear to support the <code>&lt;canvas&gt;</code> element.\n</canvas>';

								parser(content.split("\n"), items);
								draw(output.querySelector('canvas'), items);
							});
						})(file);
						reader.readAsText(file);

						console.log("obj file");
					}
					else if (name.match(/(\.jpg|\.jpeg|\.gif|\.png)$/))
					{
						reader.onload = (function(f)
						{
							return (function (e)
							{
								content = e.target.result;

								output.innerHTML += '<p><img src="'+ content +'" /></p>';
							});
						})(file);
						reader.readAsDataURL(file);

						console.log("image file");
					}
					else if (name.match(/\.html$/))
					{
						console.log("html file");
					}
					else
					{
						reader.onload = (function(f)
						{
							return (function (e)
							{
								content = e.target.result;

								output.innerHTML += '<pre style="border: 1px solid black;" >'+ content.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;") +'</pre>';
							});
						})(file);
						reader.readAsBinaryString(file);
					}
				}


				function	parser( a_fileContent, items )
				{
					var		groupName = "untitled",

							len_a_fileContent = a_fileContent.length,
							line;

					for (var i = 0; i < len_a_fileContent; i++)
					{
						if ((line = a_fileContent[i].trim()).length && line[0] != '#')
						{
							var	tokens = line.split(/ /g).filter(function (e){return (e);});

							switch (tokens[0])
							{
								case ('g'):
									groupName = tokens[1];
									items[groupName] = {};
									break;
								default :
									{
										var	fnct = tokens[0];

										if (typeof (items[groupName][fnct]) == "undefined")
											items[groupName][fnct] = [];
										items[groupName][fnct].push(tokens.slice(1));
									}
									break;
							};
						}
					}
				}

function draw( canvas, items )
{
var gl; // A global variable for the WebGL context
	function initWebGL(canvas) {
  gl = null;

  try {
    // Try to grab the standard context. If it fails, fallback to experimental.
    gl = canvas.getContext("webgl") || canvas.getContext("experimental-webgl");
  }
  catch(e) {}

  // If we don't have a GL context, give up now
  if (!gl) {
    alert("Unable to initialize WebGL. Your browser may not support it.");
    gl = null;
  }

  return gl;
}
console.log(canvas);
console.log(items);
	// Initialize the GL context
	gl = initWebGL(canvas);

	// Only continue if WebGL is available and working

	if (gl) {
	  // Set clear color to black, fully opaque
	  gl.clearColor(0.0, 0.0, 0.0, 1.0);
	  // Enable depth testing
	  gl.enable(gl.DEPTH_TEST);
	  // Near things obscure far things
	  gl.depthFunc(gl.LEQUAL);
	  // Clear the color as well as the depth buffer.
	  gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
	}

	gl.viewport(0, 0, canvas.width, canvas.height);
}

				function	handleFileSelect(evt)
				{
					evt.stopPropagation();
					evt.preventDefault();

					document.querySelector("output").innerHTML = "";
					document.querySelector("output").appendChild(document.createElement('ul'));

					var files = evt.dataTransfer.files;

					var output = [];
					for (var i = 0, f; f = files[i]; i++)
						displayFileByType(f);

					if ( evt.target.className == "dropzone" )
					{
						evt.target.style.background = "";
					}
				}
				function	handleDragOver(evt)
				{
					evt.stopPropagation();
					evt.preventDefault();
					evt.dataTransfer.dropEffect = 'copy';
				}
				function	handleDragEnter(evt)
				{
					if ( evt.target.className == "dropzone" )
					{
						evt.target.style.background = "AliceBlue";
					}
				}
				function	handleDragLeave(evt)
				{
					if ( evt.target.className == "dropzone" )
					{
						evt.target.style.background = "";
					}
				}
				var dropZone = document.getElementsByClassName('dropzone')[0];
				dropZone.addEventListener('dragover', handleDragOver, false);
				dropZone.addEventListener('dragenter', handleDragEnter, false);
				dropZone.addEventListener('dragleave', handleDragLeave, false);
				dropZone.addEventListener('drop', handleFileSelect, false);
			</script>
		</p>
	</body>
</html>
